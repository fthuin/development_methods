% Defines a `datastore' shape for use in DFDs.  This inherits from a
% rectangle and only draws two horizontal lines.
\makeatletter
\pgfdeclareshape{datastore}{
  \inheritsavedanchors[from=rectangle]
  \inheritanchorborder[from=rectangle]
  \inheritanchor[from=rectangle]{center}
  \inheritanchor[from=rectangle]{base}
  \inheritanchor[from=rectangle]{north}
  \inheritanchor[from=rectangle]{north east}
  \inheritanchor[from=rectangle]{east}
  \inheritanchor[from=rectangle]{south east}
  \inheritanchor[from=rectangle]{south}
  \inheritanchor[from=rectangle]{south west}
  \inheritanchor[from=rectangle]{west}
  \inheritanchor[from=rectangle]{north west}
  \backgroundpath{
    %  store lower right in xa/ya and upper right in xb/yb
    \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@ya}}
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
 }
}

\makeatother
\begin{landscape}
    \begin{figure}
 \begin{tikzpicture}[
  font=\sffamily,
  every matrix/.style={ampersand replacement=\&,column sep=0.5cm,row sep=0.5cm},
  source/.style={draw,thick,rounded corners,fill=red!20,inner sep=.3cm},
  process/.style={draw,thick,ellipse,fill=yellow!20},
  sink/.style={source,fill=blue!20},
  datastore/.style={draw,very thick,shape=datastore,inner sep=.3cm},
  dots/.style={gray,scale=2},
  to/.style={->,>=stealth',shorten >=1pt,semithick,font=\sffamily\tiny},
  every node/.style={align=center, text width=1.2cm, font=\sffamily\scriptsize},
  node distance = 2.5cm
  ]


  % GSCS
  \node[sink] (gscs) {GSCS};

  % Place central point around GSCS
  \def\aCCS {6cm} \def\rCCS {-10cm}
  \def\aCI  {-8cm} \def\rCI {-2cm}
  \def\aCCR {-2cm} \def\rCCR {7cm}
  \def\aCLI {1cm} \def\rCLI {13cm}
  \node[source]    (ccs)    [above right= \aCCS and \rCCS of gscs] {CCS};
  \node[source]    (ci)     [above right= \aCI and \rCI of gscs]   {CI};
  \node[source]    (ccr)    [above right= \aCCR and \rCCR of gscs] {CCR};
  \node[source]    (client) [above right= \aCLI and \rCLI of gscs] {Customer};

  % Place point dependant of central point
  \def\rGP  {3cm}
  \def\rGPI {7cm}
  \def\rCA  {8cm}
  \def\bINV {6cm}
  \node[source]    (gp)     [right=\rGP of ccs]   {GP};
  \node[source]    (gpi)    [right= \rGPI of gp] {GPI};
  \node[datastore] (inv)    [below = \bINV of ccs] {Inventory};
  \node[source]    (cash)   [right= \rCA of ci]   {Cashier};



  % CCS
  \node[process] (ccsPay) [below=of ccs] {Payment};
  \node[process] (ccsPayOk) [below right=1.5cm and 0.5cm of ccs]{Payment approval};

  % Inventory
  \node[process] (invUpd) [above right=0.3cm and 1cm of inv] {Update inventory};
  \node[process] (invUpdA) [below right=0.3cm and 2cm of inv] {Update approval};

  % GP
  \node[process] (gpInfo) [below=of gp] {Send info};

  % GPI
  \node[process] (gpAsk) [below left=0.5cm and 4cm of gpi] {Ask payment type};
  \node[process] (gpChoice) [below right=0.3cm and 0.3cm of gpAsk] {Reply choice};
  \node[process] (gpMsg) [below right =0.3cm and 0.3cm  of gpChoice] {Give msg};
  \node[process] (gpReset) [below right=0.3cm and 0.3cm  of gpMsg] {Reset state};


  % Client
  \node[process] (cliReport) [above right=5cm and -1.5cm of client] {Choose report};
  \node[process] (cliCash) [below left=0.3cm and 0.3cm of cliReport] {Choose cash};
  \node[process] (cliCard) [below left=0.3cm and 0.3cm of cliCash] {Choose card};

  \node[process] (cliInst) [below left=0.3cm and 0.3cm of cliCard] {Display inst};
  \node[process] (cliType) [below left=0.3cm and 0.3cm of cliInst] {Ask payment type};

  % CCR
  \node[process] (ccrSwipe) [above right=0.7cm and 1cm of ccr] {Swipe card};
  \node[process] (ccrSend) [above left= 0cm and 1.5cm of ccr] {Send \#card};
  \node[process] (ccrError) [below left=0cm and 1.5cm of ccr] {Send error};

  % Cashier
  \node[process] (cashInput) [left=of cash] {Input data};
  \node[process] (cashCancel) [above=0.5cm of cashInput] {Cancel operation};
  \node[process] (cashShut) [below=0.5cm of cashInput] {Shut down};

  \node[process] (cashChange) [above right=1.5cm and 4cm of cash] {Give change};
  \node[process] (cashReport) [above left=0.3cm and 0.3cm of cashChange] {Report monthly};
  \node[process] (cashCash) [left=0.5cm of cashReport] {Pay cash};

  % CI
  \node[process] (ciValidate) [above left=1.5cm and 2.5cm of ci]{Validate payment};
  \node[process] (ciError)    [left=0.1cm of ciValidate]{Send error};
  \node[process] (ciShut)     [below left=0.1cm and 0.1cm of ciError] {Shutting down};
  \node[process] (ciInfo)     [above right=0.1cm and 0.1cm of ciValidate]{Send info};
  \node[process] (ciCash)     [right=0.1cm of ciInfo]{Pay cash};
  \node[process] (ciReport)   [right=0.1cm of ciCash]{Report monthly};
  \node[process] (ciMonthly)  [above right=0.1cm and 0.1cm  of ciReport]{Pay monthly};



  % Draw the arrows between the nodes and label them.
%  \draw[to] (hisparcbox) -- node[midway,above] {raw events}
%      node[midway,below] {level 0} (daq);
%  \draw[to] (daq) -- node[midway,right] {raw event data\\level 1} (buffer);
%  \draw[to] (buffer) --
%      node[midway,right] {raw event data\\level 1} (monitor);
%  \draw[to] (monitor) to[bend right=50] node[midway,above] {events}
%      node[midway,below] {level 1} (storage);
%  \draw[to] (storage) to[bend right=50] node[midway,above] {events}
%      node[midway,below] {level 1} (monitor);
%  \draw[to] (monitor) -- node[midway,above] {events}
%  node[midway,below] {level 1} (datastore);
\end{tikzpicture}
\caption{Data-flow diagram}
\label{fig:data-flow}
\end{figure}
\end{landscape}
